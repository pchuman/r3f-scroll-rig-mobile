import e from"zustand";import{useLayoutEffect as t,useEffect as o,forwardRef as r,useRef as n,useImperativeHandle as l,useCallback as i,useState as s,useMemo as c}from"react";import a from"lenis";import{useInView as d}from"react-intersection-observer";import{ResizeObserver as u}from"@juggle/resize-observer";import h from"debounce";import w from"vecn";function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},p.apply(this,arguments)}function v(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var o=e[Symbol.toPrimitive];if(void 0!==o){var r=o.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}const m=e(e=>({debug:!1,scaleMultiplier:1,globalRender:!0,globalPriority:1e3,globalClearDepth:!1,globalRenderQueue:!1,clearGlobalRenderQueue:()=>e(()=>({globalRenderQueue:!1})),isCanvasAvailable:!1,hasSmoothScrollbar:!1,canvasChildren:{},renderToCanvas:(t,o,r={})=>e(({canvasChildren:e})=>Object.getOwnPropertyDescriptor(e,t)?(e[t].instances+=1,e[t].props.inactive=!1,{canvasChildren:e}):{canvasChildren:p({},e,{[t]:{mesh:o,props:r,instances:1}})}),updateCanvas:(t,o)=>e(({canvasChildren:e})=>{if(!e[t])return;const{[t]:{mesh:r,props:n,instances:l}}=e;return{canvasChildren:p({},e,{[t]:{mesh:r,props:p({},n,o),instances:l}})}}),removeFromCanvas:(t,o=!0)=>e(({canvasChildren:e})=>{var r;return(null==(r=e[t])?void 0:r.instances)>1?(e[t].instances-=1,{canvasChildren:e}):o?{canvasChildren:function(e,t){if(null==e)return{};var o,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)t.indexOf(o=l[r])>=0||(n[o]=e[o]);return n}(e,[t].map(v))}:(e[t].instances=0,e[t].props.inactive=!0,{canvasChildren:p({},e)})}),pageReflow:0,requestReflow:()=>{e(e=>({pageReflow:e.pageReflow+1}))},scroll:{y:0,x:0,limit:0,velocity:0,progress:0,direction:0,scrollDirection:void 0},__lenis:void 0,scrollTo:()=>{},onScroll:()=>()=>{},useRawScroll:!1,useRawScrollOnMobile:!1})),g=()=>({enabled:m(e=>e.hasSmoothScrollbar),scroll:m(e=>e.scroll),scrollTo:m(e=>e.scrollTo),onScroll:m(e=>e.onScroll),__lenis:m(e=>e.__lenis)}),f="undefined"!=typeof window?t:o,b=r(({children:e,enabled:t=!0,locked:r=!1,scrollRestoration:s="auto",disablePointerOnScroll:c=!0,horizontal:d=!1,scrollInContainer:u=!1,updateGlobalState:h=!0,onScroll:w,config:v={},invalidate:g=(()=>{}),addEffect:b,useRawScroll:y=!1,useRawScrollOnMobile:S=!1},R)=>{const E=n(),C=n(!1),T=m(e=>e.scroll);l(R,()=>({start:()=>{var e;return null==(e=E.current)?void 0:e.start()},stop:()=>{var e;return null==(e=E.current)?void 0:e.stop()},on:(e,t)=>{var o;return null==(o=E.current)?void 0:o.on(e,t)},scrollTo:(e,t)=>{var o;return null==(o=E.current)?void 0:o.scrollTo(e,t)},raf:e=>{var t;return null==(t=E.current)?void 0:t.raf(e)},__lenis:E.current}));const L=i(e=>{c&&C.current!==e&&(C.current=e,document.documentElement.style.pointerEvents=e?"none":"auto")},[c,C]);return f(()=>{"scrollRestoration"in window.history&&(window.history.scrollRestoration=s)},[]),f(()=>{const e=document.documentElement,o=document.body,r=document.body.firstElementChild;let n;if(e.classList.toggle("ScrollRig-scrollHtml",u),o.classList.toggle("ScrollRig-scrollWrapper",u),u&&Object.assign(v,{smoothTouch:!0,wrapper:o,content:r}),E.current=new a(p({orientation:d?"horizontal":"vertical"},v,t?{}:{smoothWheel:!1,syncTouch:!1,smoothTouch:!1})),b)n=b(e=>{var t;return null==(t=E.current)?void 0:t.raf(e)});else{let e;e=requestAnimationFrame(function t(o){var r;null==(r=E.current)||r.raf(o),e=requestAnimationFrame(t)}),n=()=>cancelAnimationFrame(e)}return()=>{var e;n(),null==(e=E.current)||e.destroy()}},[t]),f(()=>{const e=E.current,t=({scroll:e,limit:t,velocity:o,direction:r,progress:n})=>{const l=d?e:0;h&&(T.y=d?0:e,T.x=l,T.limit=t,T.velocity=o,T.direction=r,T.progress=n||0),Math.abs(o)>1.5&&L(!0),Math.abs(o)<1&&L(!1),w&&w({scroll:e,limit:t,velocity:o,direction:r,progress:n}),g()};return null==e||e.on("scroll",t),h&&(T.scrollDirection=d?"horizontal":"vertical",m.setState({__lenis:e,scrollTo:(...t)=>{null==e||e.scrollTo(...t)},onScroll:t=>(null==e||e.on("scroll",t),null==e||e.emit(),()=>null==e?void 0:e.off("scroll",t))}),m.getState().scroll.y=window.scrollY,m.getState().scroll.x=window.scrollX),null==e||e.emit(),()=>{null==e||e.off("scroll",t),h&&m.setState({__lenis:void 0,onScroll:()=>()=>{},scrollTo:()=>{}})}},[t]),f(()=>{const e=()=>g(),t=()=>L(!1);return window.addEventListener("pointermove",t),window.addEventListener("pointerdown",t),window.addEventListener("wheel",e),()=>{window.removeEventListener("pointermove",t),window.removeEventListener("pointerdown",t),window.removeEventListener("wheel",e)}},[]),o(()=>(h&&(document.documentElement.classList.toggle("js-smooth-scrollbar-enabled",t),document.documentElement.classList.toggle("js-smooth-scrollbar-disabled",!t),m.setState({hasSmoothScrollbar:t,useRawScroll:y,useRawScrollOnMobile:S})),()=>{document.documentElement.classList.remove("js-smooth-scrollbar-enabled"),document.documentElement.classList.remove("js-smooth-scrollbar-disabled")}),[t,y,S]),o(()=>{var e,t;r?null==(e=E.current)||e.stop():null==(t=E.current)||t.start()},[r]),e?e({}):null}),y="undefined"!=typeof window;function S(e,t,o,r,n){return r+(e-t)*(n-r)/(o-t)}function R(e,t){const r=function({debounce:e=0}={}){const[t,r]=s({width:y?window.innerWidth:Infinity,height:y?window.innerHeight:Infinity});return o(()=>{const o=document.getElementById("ScrollRig-canvas");function n(){const e=o?o.clientWidth:window.innerWidth,n=o?o.clientHeight:window.innerHeight;e===t.width&&n===t.height||r({width:e,height:n})}const l=h.debounce(n,e),i=window.ResizeObserver||u;let s;return o?(s=new i(l),s.observe(o)):window.addEventListener("resize",l),n(),()=>{var e;window.removeEventListener("resize",l),null==(e=s)||e.disconnect()}},[t,r]),t}(),{scroll:l,onScroll:a}=g(),v=m(e=>e.__lenis),b=m(e=>e.useRawScroll),R=m(e=>e.useRawScrollOnMobile),E=m(e=>e.scaleMultiplier),C=m(e=>e.pageReflow),T=m(e=>e.debug),{rootMargin:L,threshold:O,autoUpdate:j,wrapper:M}=c(()=>{const e={rootMargin:"0%",threshold:0,autoUpdate:!0},o=t||{};return Object.keys(o).map((t,r)=>{void 0!==o[t]&&(e[t]=o[t])}),e},[t]),{ref:_,inView:x}=d({rootMargin:L,threshold:O});f(()=>{_(e.current)},[e,null==e?void 0:e.current]);const[z,V]=s(w.vec3(0,0,0)),P=n({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,I=n({top:0,bottom:0,left:0,right:0,width:0,height:0}).current,[U,k]=s(I),A=n({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,Y=n(w.vec3(0,0,0)).current;f(()=>{var t;const o=null==(t=e.current)?void 0:t.getBoundingClientRect();if(!o)return;const n=M?M.scrollTop:window.scrollY,l=M?M.scrollLeft:window.scrollX;I.top=o.top+n,I.bottom=o.bottom+n,I.left=o.left+l,I.right=o.right+l,I.width=o.width,I.height=o.height,k(p({},I)),V(w.vec3((null==I?void 0:I.width)*E,(null==I?void 0:I.height)*E,1)),T&&console.log("useTracker.getBoundingClientRect:",I,"intialScroll:",{initialY:n,initialX:l},"size:",r,"pageReflow:",C)},[e,r,C,E,T]);const B=i(({onlyUpdateInViewport:t=!1,scroll:o}={})=>{if(!e.current||t&&!P.inViewport)return;const n="undefined"!=typeof navigator&&/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent),i="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(pointer: coarse)").matches,s="horizontal"===(o||l).scrollDirection;let c=o||l;if(b||R&&(n||i)){var a;const e=null!=(a=null==v?void 0:v.targetScroll)?a:s?window.scrollX:window.scrollY;c=p({},l,{y:s?0:e,x:s?e:0})}!function(e,t,o,r){e.top=t.top-(o.y||0),e.bottom=t.bottom-(o.y||0),e.left=t.left-(o.x||0),e.right=t.right-(o.x||0),e.width=t.width,e.height=t.height,e.x=e.left+.5*t.width-.5*r.width,e.y=e.top+.5*t.height-.5*r.height,e.positiveYUpBottom=r.height-e.bottom}(A,I,c,r),function(e,t,o){e.x=t.x*o,e.y=-1*t.y*o}(Y,A,E);const d=s?"width":"height",u=r[d]-A[s?"left":"top"];P.progress=S(u,0,r[d]+A[d],0,1),P.visibility=S(u,0,A[d],0,1),P.viewport=S(u,0,r[d],0,1)},[e,r,E,l,b,R,v]);return f(()=>{P.inViewport=x,B({onlyUpdateInViewport:!1}),T&&console.log("useTracker.inViewport:",x,"update()")},[x]),f(()=>{B({onlyUpdateInViewport:!1}),T&&console.log("useTracker.update on resize/reflow")},[B,C]),o(()=>{if(j)return a(e=>B({onlyUpdateInViewport:!0}))},[j,B,a]),{scale:z,inViewport:x,rect:U,bounds:A,position:Y,scrollState:P,update:B}}export{b as SmoothScrollbar,g as useScrollbar,R as useTracker};
//# sourceMappingURL=scrollbar.modern.js.map
