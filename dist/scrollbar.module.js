import n from"zustand";import{useLayoutEffect as t,useEffect as o,forwardRef as e,useRef as r,useImperativeHandle as i,useCallback as l,useState as c,useMemo as u}from"react";import a from"lenis";import{useInView as s}from"react-intersection-observer";import{ResizeObserver as d}from"@juggle/resize-observer";import f from"debounce";import v from"vecn";function h(){return h=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&(n[e]=o[e])}return n},h.apply(this,arguments)}function p(n){var t=function(n,t){if("object"!=typeof n||null===n)return n;var o=n[Symbol.toPrimitive];if(void 0!==o){var e=o.call(n,"string");if("object"!=typeof e)return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==typeof t?t:String(t)}var w=n(function(n){return{debug:!1,scaleMultiplier:1,globalRender:!0,globalPriority:1e3,globalClearDepth:!1,globalRenderQueue:!1,clearGlobalRenderQueue:function(){return n(function(){return{globalRenderQueue:!1}})},isCanvasAvailable:!1,hasSmoothScrollbar:!1,canvasChildren:{},renderToCanvas:function(t,o,e){return void 0===e&&(e={}),n(function(n){var r,i=n.canvasChildren;return Object.getOwnPropertyDescriptor(i,t)?(i[t].instances+=1,i[t].props.inactive=!1,{canvasChildren:i}):{canvasChildren:h({},i,((r={})[t]={mesh:o,props:e,instances:1},r))}})},updateCanvas:function(t,o){return n(function(n){var e,r=n.canvasChildren;if(r[t]){var i=r[t],l=i.instances;return{canvasChildren:h({},r,((e={})[t]={mesh:i.mesh,props:h({},i.props,o),instances:l},e))}}})},removeFromCanvas:function(t,o){return void 0===o&&(o=!0),n(function(n){var e,r=n.canvasChildren;return(null==(e=r[t])?void 0:e.instances)>1?(r[t].instances-=1,{canvasChildren:r}):o?{canvasChildren:function(n,t){if(null==n)return{};var o,e,r={},i=Object.keys(n);for(e=0;e<i.length;e++)t.indexOf(o=i[e])>=0||(r[o]=n[o]);return r}(r,[t].map(p))}:(r[t].instances=0,r[t].props.inactive=!0,{canvasChildren:h({},r)})})},pageReflow:0,requestReflow:function(){n(function(n){return{pageReflow:n.pageReflow+1}})},scroll:{y:0,x:0,limit:0,velocity:0,progress:0,direction:0,scrollDirection:void 0},__lenis:void 0,scrollTo:function(){},onScroll:function(){return function(){}},useRawScroll:!1,useRawScrollOnMobile:!1}}),m=function(){return{enabled:w(function(n){return n.hasSmoothScrollbar}),scroll:w(function(n){return n.scroll}),scrollTo:w(function(n){return n.scrollTo}),onScroll:w(function(n){return n.onScroll}),__lenis:w(function(n){return n.__lenis})}},g="undefined"!=typeof window?t:o,b=e(function(n,t){var e=n.children,c=n.enabled,u=void 0===c||c,s=n.locked,d=void 0!==s&&s,f=n.scrollRestoration,v=void 0===f?"auto":f,p=n.disablePointerOnScroll,m=void 0===p||p,b=n.horizontal,y=void 0!==b&&b,S=n.scrollInContainer,R=void 0!==S&&S,E=n.updateGlobalState,C=void 0===E||E,T=n.onScroll,L=n.config,O=void 0===L?{}:L,j=n.invalidate,M=void 0===j?function(){}:j,_=n.addEffect,x=n.useRawScroll,z=void 0!==x&&x,V=n.useRawScrollOnMobile,P=void 0!==V&&V,I=r(),U=r(!1),k=w(function(n){return n.scroll});i(t,function(){return{start:function(){var n;return null==(n=I.current)?void 0:n.start()},stop:function(){var n;return null==(n=I.current)?void 0:n.stop()},on:function(n,t){var o;return null==(o=I.current)?void 0:o.on(n,t)},scrollTo:function(n,t){var o;return null==(o=I.current)?void 0:o.scrollTo(n,t)},raf:function(n){var t;return null==(t=I.current)?void 0:t.raf(n)},__lenis:I.current}});var A=l(function(n){m&&U.current!==n&&(U.current=n,document.documentElement.style.pointerEvents=n?"none":"auto")},[m,U]);return g(function(){"scrollRestoration"in window.history&&(window.history.scrollRestoration=v)},[]),g(function(){var n,t,o=document.documentElement,e=document.body,r=document.body.firstElementChild;return o.classList.toggle("ScrollRig-scrollHtml",R),e.classList.toggle("ScrollRig-scrollWrapper",R),R&&Object.assign(O,{smoothTouch:!0,wrapper:e,content:r}),I.current=new a(h({orientation:y?"horizontal":"vertical"},O,u?{}:{smoothWheel:!1,syncTouch:!1,smoothTouch:!1})),_?n=_(function(n){var t;return null==(t=I.current)?void 0:t.raf(n)}):(t=requestAnimationFrame(function n(o){var e;null==(e=I.current)||e.raf(o),t=requestAnimationFrame(n)}),n=function(){return cancelAnimationFrame(t)}),function(){var t;n(),null==(t=I.current)||t.destroy()}},[u]),g(function(){var n=I.current,t=function(n){var t=n.scroll,o=n.limit,e=n.velocity,r=n.direction,i=n.progress,l=y?t:0;C&&(k.y=y?0:t,k.x=l,k.limit=o,k.velocity=e,k.direction=r,k.progress=i||0),Math.abs(e)>1.5&&A(!0),Math.abs(e)<1&&A(!1),T&&T({scroll:t,limit:o,velocity:e,direction:r,progress:i}),M()};return null==n||n.on("scroll",t),C&&(k.scrollDirection=y?"horizontal":"vertical",w.setState({__lenis:n,scrollTo:function(){null==n||n.scrollTo.apply(n,[].slice.call(arguments))},onScroll:function(t){return null==n||n.on("scroll",t),null==n||n.emit(),function(){return null==n?void 0:n.off("scroll",t)}}}),w.getState().scroll.y=window.scrollY,w.getState().scroll.x=window.scrollX),null==n||n.emit(),function(){null==n||n.off("scroll",t),C&&w.setState({__lenis:void 0,onScroll:function(){return function(){}},scrollTo:function(){}})}},[u]),g(function(){var n=function(){return M()},t=function(){return A(!1)};return window.addEventListener("pointermove",t),window.addEventListener("pointerdown",t),window.addEventListener("wheel",n),function(){window.removeEventListener("pointermove",t),window.removeEventListener("pointerdown",t),window.removeEventListener("wheel",n)}},[]),o(function(){return C&&(document.documentElement.classList.toggle("js-smooth-scrollbar-enabled",u),document.documentElement.classList.toggle("js-smooth-scrollbar-disabled",!u),w.setState({hasSmoothScrollbar:u,useRawScroll:z,useRawScrollOnMobile:P})),function(){document.documentElement.classList.remove("js-smooth-scrollbar-enabled"),document.documentElement.classList.remove("js-smooth-scrollbar-disabled")}},[u,z,P]),o(function(){var n,t;d?null==(n=I.current)||n.stop():null==(t=I.current)||t.start()},[d]),e?e({}):null}),y="undefined"!=typeof window;function S(n,t,o,e,r){return e+(n-t)*(r-e)/(o-t)}function R(n,t){var e=function(n){var t={}.debounce,e=void 0===t?0:t,r=c({width:y?window.innerWidth:Infinity,height:y?window.innerHeight:Infinity}),i=r[0],l=r[1];return o(function(){var n=document.getElementById("ScrollRig-canvas");function t(){var t=n?n.clientWidth:window.innerWidth,o=n?n.clientHeight:window.innerHeight;t===i.width&&o===i.height||l({width:t,height:o})}var o,r=f.debounce(t,e),c=window.ResizeObserver||d;return n?(o=new c(r)).observe(n):window.addEventListener("resize",r),t(),function(){var n;window.removeEventListener("resize",r),null==(n=o)||n.disconnect()}},[i,l]),i}(),i=m(),a=i.scroll,p=i.onScroll,b=w(function(n){return n.__lenis}),R=w(function(n){return n.useRawScroll}),E=w(function(n){return n.useRawScrollOnMobile}),C=w(function(n){return n.scaleMultiplier}),T=w(function(n){return n.pageReflow}),L=w(function(n){return n.debug}),O=u(function(){var n={rootMargin:"0%",threshold:0,autoUpdate:!0},o=t||{};return Object.keys(o).map(function(t,e){void 0!==o[t]&&(n[t]=o[t])}),n},[t]),j=O.autoUpdate,M=O.wrapper,_=s({rootMargin:O.rootMargin,threshold:O.threshold}),x=_.ref,z=_.inView;g(function(){x(n.current)},[n,null==n?void 0:n.current]);var V=c(v.vec3(0,0,0)),P=V[0],I=V[1],U=r({inViewport:!1,progress:-1,visibility:-1,viewport:-1}).current,k=r({top:0,bottom:0,left:0,right:0,width:0,height:0}).current,A=c(k),Y=A[0],B=A[1],D=r({top:0,bottom:0,left:0,right:0,width:0,height:0,x:0,y:0,positiveYUpBottom:0}).current,W=r(v.vec3(0,0,0)).current;g(function(){var t,o=null==(t=n.current)?void 0:t.getBoundingClientRect();if(o){var r=M?M.scrollTop:window.scrollY,i=M?M.scrollLeft:window.scrollX;k.top=o.top+r,k.bottom=o.bottom+r,k.left=o.left+i,k.right=o.right+i,k.width=o.width,k.height=o.height,B(h({},k)),I(v.vec3((null==k?void 0:k.width)*C,(null==k?void 0:k.height)*C,1)),L&&console.log("useTracker.getBoundingClientRect:",k,"intialScroll:",{initialY:r,initialX:i},"size:",e,"pageReflow:",T)}},[n,e,T,C,L]);var F=l(function(t){var o=void 0===t?{}:t,r=o.onlyUpdateInViewport,i=o.scroll;if(n.current&&(void 0===r||!r||U.inViewport)){var l="undefined"!=typeof navigator&&/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent),c="undefined"!=typeof window&&"function"==typeof window.matchMedia&&window.matchMedia("(pointer: coarse)").matches,u="horizontal"===(i||a).scrollDirection,s=i||a;if(R||E&&(l||c)){var d,f=null!=(d=null==b?void 0:b.targetScroll)?d:u?window.scrollX:window.scrollY;s=h({},a,{y:u?0:f,x:u?f:0})}!function(n,t,o,e){n.top=t.top-(o.y||0),n.bottom=t.bottom-(o.y||0),n.left=t.left-(o.x||0),n.right=t.right-(o.x||0),n.width=t.width,n.height=t.height,n.x=n.left+.5*t.width-.5*e.width,n.y=n.top+.5*t.height-.5*e.height,n.positiveYUpBottom=e.height-n.bottom}(D,k,s,e),function(n,t,o){n.x=t.x*o,n.y=-1*t.y*o}(W,D,C);var v=u?"width":"height",p=e[v]-D[u?"left":"top"];U.progress=S(p,0,e[v]+D[v],0,1),U.visibility=S(p,0,D[v],0,1),U.viewport=S(p,0,e[v],0,1)}},[n,e,C,a,R,E,b]);return g(function(){U.inViewport=z,F({onlyUpdateInViewport:!1}),L&&console.log("useTracker.inViewport:",z,"update()")},[z]),g(function(){F({onlyUpdateInViewport:!1}),L&&console.log("useTracker.update on resize/reflow")},[F,T]),o(function(){if(j)return p(function(n){return F({onlyUpdateInViewport:!0})})},[j,F,p]),{scale:P,inViewport:z,rect:Y,bounds:D,position:W,scrollState:U,update:F}}export{b as SmoothScrollbar,m as useScrollbar,R as useTracker};
//# sourceMappingURL=scrollbar.module.js.map
